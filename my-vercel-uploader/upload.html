<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Qloud ‚Äî Upload</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
:root{
  --sidebar-w:270px;
  --sidebar-collapsed-w:88px;
  --feature-w:380px;
  --gap:28px;
  --bg:#f5f7fb;
}

html,body{height:100%;}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
  background:var(--bg);
  color:#0f172a;
}

/* ---------------- SIDEBAR ---------------- */
.sidebar{
  position:fixed;
  inset:16px auto 16px 16px;
  width:var(--sidebar-w);
  background:#fff;
  border-radius:14px;
  box-shadow:0 12px 36px rgba(2,6,23,.06);
  display:flex;
  flex-direction:column;
  overflow-y:auto;
  overflow-x:hidden; /* üîí kill horizontal scrollbar */
  transition:width .45s cubic-bezier(.175,.885,.32,1.1);
  z-index:50;
}
.sidebar.collapsed{ width:var(--sidebar-collapsed-w); }

/* hide scrollbar */
.sidebar::-webkit-scrollbar{ width:6px; }
.sidebar::-webkit-scrollbar-thumb{ background:transparent; }

/* header */
.sidebar-header{
  display:flex;
  gap:12px;
  padding:16px;
  align-items:center;
}
.avatar{
  width:44px;height:44px;border-radius:10px;
  background:#eef2ff;
  display:flex;align-items:center;justify-content:center;
  font-weight:700;color:#374151;
  flex-shrink:0;
}
.profile-block{ min-width:0; }
.profile-name-row{ display:flex; gap:6px; align-items:center; }
.profile-name{
  font-weight:600;
  max-width:150px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.profile-token{
  font-size:12px;
  color:#64748b;
  max-width:160px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* collapse labels */
.label{ transition:.2s; }
.sidebar.collapsed .label{
  opacity:0;
  transform:translateX(-6px);
  pointer-events:none;
}

/* ---------------- NAV ---------------- */
.nav{ padding:8px 12px; flex:1; }
.nav-item{ position:relative; margin-bottom:8px; }
.nav-btn{
  display:flex; align-items:center; gap:12px;
  padding:10px;
  border-radius:10px;
  color:#475569;
  cursor:pointer;
}
.nav-btn:hover{ background:#f8fafc; color:#0f172a; }
.nav-icon{ width:20px;height:20px; }

/* tooltip */
.tooltip{
  position:absolute;
  left:100%; top:50%;
  transform:translate(8px,-50%);
  background:#0f172a;
  color:#fff;
  padding:6px 10px;
  border-radius:8px;
  font-size:12px;
  opacity:0;
  pointer-events:none;
  transition:.2s;
}
.sidebar.collapsed .nav-item:hover .tooltip{
  opacity:1;
  transform:translate(14px,-50%);
}

/* ---------------- STORAGE ---------------- */
.sidebar-footer{
  padding:12px;
  border-top:1px solid rgba(2,6,23,.04);
}
.storage-expanded{ display:block; }
.storage-collapsed{ display:none; justify-content:center; }

.sidebar.collapsed .storage-expanded{ display:none; }
.sidebar.collapsed .storage-collapsed{ display:flex; }

.storage-bar{
  width:100%;
  height:10px;
  background:rgba(2,6,23,.08);
  border-radius:999px;
  overflow:hidden;
}
.storage-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#6366f1,#06b6d4);
  transition:width .6s cubic-bezier(.2,.9,.2,1);
}

/* ---------------- APP ---------------- */
.app{
  margin-left:calc(var(--sidebar-w) + var(--gap));
  padding:28px 32px;
  transition:margin .3s ease;
}
.sidebar.collapsed ~ .app{
  margin-left:calc(var(--sidebar-collapsed-w) + var(--gap));
}

/* feature open */
.feature-open .app{
  margin-right:calc(var(--feature-w) + var(--gap));
}

/* ---------------- UPLOAD ---------------- */
.upload-box{
  border:2px dashed #c7d2fe;
  background:#fff;
  border-radius:12px;
  padding:44px;
  text-align:center;
  cursor:pointer;
}
.upload-box:hover{
  background:#fbfdff;
  box-shadow:0 10px 30px rgba(2,6,23,.05);
}

/* ---------------- FILES ---------------- */
.file-card{
  background:#fff;
  border-radius:10px;
  padding:12px;
  border:1px solid rgba(2,6,23,.04);
  position:relative;
}
.file-actions{
  position:absolute; top:8px; right:8px;
  display:flex; gap:6px;
  opacity:0;
}
.file-card:hover .file-actions{ opacity:1; }

/* ---------------- FEATURE PANEL ---------------- */
.feature-panel{
  position:fixed;
  right:16px; top:16px; bottom:16px;
  width:var(--feature-w);
  background:#fff;
  border-radius:14px;
  box-shadow:0 14px 40px rgba(2,6,23,.06);
  padding:16px;
  display:none;
  overflow:auto;
  z-index:40;
}
.feature-panel.active{ display:block; }
</style>
</head>

<body>

<!-- SIDEBAR -->
<aside id="sidebar" class="sidebar collapsed">
  <div class="sidebar-header">
    <div class="avatar">U</div>
    <div class="profile-block label">
      <div class="profile-name-row">
        <div id="profileName" class="profile-name">Profile</div>
        <button id="editNameBtn" class="hidden"><i data-lucide="edit-2" class="w-4 h-4"></i></button>
      </div>
      <div id="profileToken" class="profile-token"></div>
    </div>
  </div>

  <nav class="nav">
    <div class="nav-item">
      <div class="nav-btn feature-btn" data-feature="search">
        <i data-lucide="search" class="nav-icon"></i><span class="label">Token Search</span>
      </div>
      <div class="tooltip">Token Search</div>
    </div>

    <div class="nav-item">
      <div class="nav-btn feature-btn" data-feature="merge">
        <i data-lucide="shuffle" class="nav-icon"></i><span class="label">Token Merge</span>
      </div>
      <div class="tooltip">Token Merge</div>
    </div>

    <div class="nav-item">
      <div class="nav-btn feature-btn" data-feature="delete">
        <i data-lucide="trash-2" class="nav-icon"></i><span class="label">Delete Token</span>
      </div>
      <div class="tooltip">Delete Token</div>
    </div>
  </nav>

  <div class="sidebar-footer">
    <div class="storage-expanded label">
      <div class="text-xs text-slate-500 mb-1">Global storage usage</div>
      <div class="storage-bar"><div id="storageFill" class="storage-fill"></div></div>
      <div id="storageText" class="text-xs text-slate-500 mt-1">Loading‚Ä¶</div>
    </div>
    <div class="storage-collapsed">
      <i data-lucide="cloud" class="w-5 h-5 text-slate-500"></i>
    </div>
  </div>

  <div class="p-3">
    <div id="logoutBtn" class="nav-btn">
      <i data-lucide="log-out" class="nav-icon"></i><span class="label">Logout</span>
    </div>
  </div>
</aside>

<!-- MAIN -->
<main id="app" class="app">
  <div class="max-w-5xl mx-auto">
    <div id="uploadBox" class="upload-box">
      <input id="fileInput" type="file" multiple hidden>
      ‚òÅÔ∏è<div class="font-semibold mt-2">Click or drag & drop files</div>
      <div class="text-sm text-slate-500">Private to this token</div>
    </div>

    <section class="mt-6">
      <h2 class="font-semibold mb-3">Files <span id="count" class="text-slate-500"></span></h2>
      <div id="fileGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>
    </section>
  </div>
</main>

<!-- FEATURE PANEL -->
<aside id="featurePanel" class="feature-panel"></aside>

<script>
lucide.createIcons();

/* ---------- BASIC BOOTSTRAP ---------- */
const token = new URLSearchParams(location.search).get('token');
if(!token) location.href='index.html';
document.getElementById('profileToken').textContent = token;

/* sidebar hover */
const sidebar = document.getElementById('sidebar');
const editBtn = document.getElementById('editNameBtn');
sidebar.addEventListener('mouseenter',()=>{ sidebar.classList.remove('collapsed'); editBtn.classList.remove('hidden'); });
sidebar.addEventListener('mouseleave',()=>{ sidebar.classList.add('collapsed'); editBtn.classList.add('hidden'); });

/* storage summary (same as index) */
async function refreshStorage(){
  try{
    const r = await fetch('/api/storage-summary');
    const d = await r.json();
    const pct = Math.min(100,(d.totalBytes/d.limitBytes)*100);
    storageFill.style.width = pct+'%';
    storageText.textContent = `${(d.totalBytes/1e6).toFixed(2)} MB / ${(d.limitBytes/1e9).toFixed(2)} GB`;
  }catch{ storageText.textContent='Error'; }
}
refreshStorage(); setInterval(refreshStorage,60000);

/* feature panel toggle */
const featurePanel = document.getElementById('featurePanel');
document.querySelectorAll('.feature-btn').forEach(b=>{
  b.onclick=()=>{
    document.documentElement.classList.add('feature-open');
    featurePanel.classList.add('active');
    featurePanel.innerHTML = `<div class="text-slate-500">Feature: ${b.dataset.feature}</div>`;
  };
});
document.addEventListener('click',e=>{
  if(!e.target.closest('.feature-btn') && !e.target.closest('#featurePanel')){
    featurePanel.classList.remove('active');
    document.documentElement.classList.remove('feature-open');
  }
});

/* logout */
logoutBtn.onclick=()=>location.href='index.html';
</script>
</body>
</html>
