<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Qloud — Home</title>
<script src="https://cdn.tailwindcss.com"></script>
<!-- Three.js for the 3D cloud -->
<script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
<!-- Simplex noise for subtle cloud motion -->
<script src="https://unpkg.com/simplex-noise@2.4.0/simplex-noise.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
  body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  .canvas-wrap{height:380px; border-radius:16px; overflow:hidden; background:linear-gradient(180deg,#0f172a,#071028);}
  .glass{backdrop-filter: blur(6px); background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius:12px;}
  .meter {height: 18px; background: rgba(255,255,255,0.06); border-radius: 999px; overflow:hidden;}
  .meter > span {display:block; height:100%; border-radius:999px; transition: width .6s ease;}
  .dot-menu {width:36px;height:36px;border-radius:10px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;cursor:pointer;}
</style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen flex items-center justify-center p-6">
  <div class="max-w-5xl w-full grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Left: 3D Cloud + info -->
    <div class="glass p-6 canvas-wrap relative">
      <div id="three-container" style="position:absolute;inset:0;"></div>
      <div class="absolute left-6 top-6">
        <h1 class="text-2xl font-bold">Qloud</h1>
        <p class="text-sm opacity-80">Store files. Share with a token. Access from anywhere.</p>
      </div>
      <div class="absolute left-6 bottom-6 w-[calc(100%-3rem)] grid grid-cols-1 gap-3">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-xs opacity-80">Global storage used</div>
            <div class="text-sm font-semibold">Shared backend pool</div>
          </div>
          <div class="text-xs opacity-80" id="storageUsageText">—</div>
        </div>
        <div class="meter" aria-hidden>
          <span id="storageFill" style="width:0%; background: linear-gradient(90deg,#4facfe,#00f2fe);"></span>
        </div>

        <div class="flex items-center justify-between mt-2">
          <div class="text-xs opacity-80">Tokens created</div>
          <div class="font-medium" id="tokenCount">—</div>
        </div>
      </div>
    </div>

    <!-- Right: token entry / quick actions -->
    <div class="glass p-6 flex flex-col gap-4">
      <div>
        <h2 class="text-lg font-bold">Enter your Token</h2>
        <p class="text-sm opacity-80 mb-3">Use a token to access an upload space. If it doesn't exist, one will be created for you.</p>
      </div>

      <div class="flex gap-3">
        <input id="tokenInput" class="flex-1 rounded-lg px-4 py-3 bg-transparent border border-white/8 placeholder:text-slate-400" placeholder="paste token or press Create new" />
        <button id="useTokenBtn" class="px-4 py-3 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-400 text-slate-900 font-semibold">Go</button>
      </div>

      <div class="flex gap-3">
        <button id="createBtn" class="flex-1 px-4 py-3 rounded-lg border border-white/6 hover:bg-white/3 transition">Create new token</button>
        <button id="demoBtn" class="px-4 py-3 rounded-lg bg-white/5">Try demo</button>
      </div>

      <div class="mt-4 text-sm text-slate-400">
        <strong>Note:</strong> Files are stored in your Cloudinary folder. Tokens map to subfolders in Cloudinary (e.g. <code>mycloud/&lt;token&gt;</code>).
      </div>

      <div class="mt-4 flex items-center justify-between">
        <div class="text-xs opacity-70">Advanced</div>
        <div class="flex items-center gap-2">
          <div class="dot-menu" id="helpMenu" title="Help (client-only)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 2v2M12 20v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M2 12h2M20 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <a href="upload.html" id="openUploadLink" class="px-3 py-2 rounded-lg bg-white/6">Open upload (token required)</a>
        </div>
      </div>
    </div>

    <!-- Full width footer explanatory row -->
    <div class="col-span-full glass p-4 flex items-center justify-between">
      <div class="text-sm">
        <strong>Cloudinary</strong> configured: <code>dzvz7kzin</code> · folder base: <code>mycloud</code>
      </div>
      <div class="text-sm opacity-70">Ready to deploy on Vercel + GitHub</div>
    </div>
  </div>

<script>
/* ========= Config (client-side demo) =========
   These are safe public values you provided for front-end uploads.
   For admin actions (listing, deleting, merging), implement Vercel serverless functions that use
   CLOUDINARY_API_KEY & CLOUDINARY_API_SECRET kept in Vercel env.
*/
const CLOUD_NAME = 'dzvz7kzin';
const UPLOAD_FOLDER = 'mycloud';

/* ======= Token system (local demo) =========
   Stores tokens in localStorage for demo: actual project should persist tokens on server
*/
function genToken(len=8){
  const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
  let t='';
  for(let i=0;i<len;i++) t+=chars[Math.floor(Math.random()*chars.length)];
  return t;
}

function loadTokens(){ return JSON.parse(localStorage.getItem('qloud_tokens')||'[]'); }
function saveTokens(arr){ localStorage.setItem('qloud_tokens', JSON.stringify(arr)); }
function ensureTokenExists(token){
  const ts = loadTokens();
  if(!ts.includes(token)) { ts.push(token); saveTokens(ts); }
}

/* UI hooks */
const tokenInput = document.getElementById('tokenInput');
const createBtn = document.getElementById('createBtn');
const useTokenBtn = document.getElementById('useTokenBtn');
const tokenCountEl = document.getElementById('tokenCount');
const storageFill = document.getElementById('storageFill');
const storageUsageText = document.getElementById('storageUsageText');

function refreshTokenCount(){
  const ts = loadTokens();
  tokenCountEl.textContent = ts.length;
}

createBtn.addEventListener('click', ()=>{
  const t = genToken(10);
  ensureTokenExists(t);
  refreshTokenCount();
  tokenInput.value = t;
  navigator.clipboard?.writeText(t).catch(()=>{});
  alert('Token created and copied to clipboard: '+t);
});

useTokenBtn.addEventListener('click', ()=>{
  const t = tokenInput.value.trim();
  if(!t){ alert('Paste a token or create one.'); return; }
  ensureTokenExists(t);
  // open upload page with token as query param
  window.location.href = `upload.html?token=${encodeURIComponent(t)}`;
});

/* Demo button opens an example token */
document.getElementById('demoBtn').addEventListener('click', ()=>{
  const demo = 'demo-token';
  ensureTokenExists(demo);
  window.location.href = `upload.html?token=${encodeURIComponent(demo)}`;
});

/* Storage meter - client-only demo
   Real storage summary needs server-side aggregation of Cloudinary resources.
   We'll attempt to call an API route first; otherwise show simulated values and show a hint.
*/
async function fetchStorageSummary(){
  try{
    // Replace with your Vercel serverless route that returns:
    // { totalBytes: 12345, limitBytes: 10*1024*1024*1024, tokensCount: 5 }
    const resp = await fetch('/api/storage-summary');
    if(!resp.ok) throw new Error('no server api');
    const data = await resp.json();
    const pct = Math.min(100, (data.totalBytes / data.limitBytes) * 100);
    storageFill.style.width = pct+'%';
    storageUsageText.textContent = `${(data.totalBytes/(1024*1024)).toFixed(2)} MB of ${(data.limitBytes/(1024*1024)).toFixed(0)} MB`;
    return;
  } catch (e) {
    // fallback demo values (client-only)
    const used = Math.floor(Math.random()*800) + 120; // MB
    const limit = 2048; // MB (2GB example)
    const pct = Math.min(100, (used/limit)*100);
    storageFill.style.width = pct+'%';
    storageUsageText.textContent = `${used} MB of ${limit} MB (demo) — add /api/storage-summary in Vercel for real data`;
  }
}

/* initial */
refreshTokenCount();
fetchStorageSummary();

/* ========= 3D cloud with Three.js (simple, interactive) ========= */
(function initCloud3D(){
  const container = document.getElementById('three-container');
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(40, container.clientWidth / container.clientHeight, 0.1, 1000);
  camera.position.set(0,0,20);
  const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(container.clientWidth, container.clientHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  container.appendChild(renderer.domElement);

  // soft ambient
  scene.add(new THREE.AmbientLight(0xffffff, 0.7));
  const point = new THREE.PointLight(0x66f6ff, 0.9);
  point.position.set(10,10,25);
  scene.add(point);

  // group of translucent spheres to form a cloud-like blob
  const group = new THREE.Group();
  const mat = new THREE.MeshStandardMaterial({ color: 0xffffff, transparent: true, opacity: 0.16, roughness: 0.8, metalness: 0.1 });
  for(let i=0;i<18;i++){
    const s = new THREE.Mesh(new THREE.SphereGeometry(2.2 + Math.random()*1.6, 24, 24), mat.clone());
    s.position.set((Math.random()-0.5)*6, (Math.random()-0.5)*2.6, (Math.random()-0.5)*4);
    s.material.opacity = 0.12 + Math.random()*0.12;
    s.scale.setScalar(0.8 + Math.random()*1.2);
    group.add(s);
  }
  scene.add(group);

  // subtle particle points inside cloud
  const ptsGeo = new THREE.BufferGeometry();
  const count = 300;
  const pos = new Float32Array(count*3);
  for(let i=0;i<count;i++){
    pos[i*3]= (Math.random()-0.5)*6;
    pos[i*3+1]= (Math.random()-0.5)*2;
    pos[i*3+2]= (Math.random()-0.5)*4;
  }
  ptsGeo.setAttribute('position', new THREE.BufferAttribute(pos,3));
  const ptsMat = new THREE.PointsMaterial({size:0.06, color:0xe6fbff, transparent:true, opacity:0.9});
  const points = new THREE.Points(ptsGeo, ptsMat);
  group.add(points);

  // interaction
  let mouseX=0, mouseY=0;
  container.addEventListener('mousemove', (e)=>{
    const rect=container.getBoundingClientRect();
    mouseX = ( (e.clientX - rect.left) / rect.width - 0.5 ) * 2;
    mouseY = ( (e.clientY - rect.top) / rect.height - 0.5 ) * 2;
  });

  // simple animation using noise
  const simplex = new SimplexNoise();
  let t=0;
  function animate(){
    t += 0.005;
    group.rotation.y += (mouseX*0.15 - group.rotation.y) * 0.03;
    group.rotation.x += (-mouseY*0.08 - group.rotation.x) * 0.03;
    // animate spheres with noise
    group.children.forEach((m,i)=>{
      const n = simplex.noise3D(i*0.12, t*0.5, 0);
      m.position.y = m.position.y + Math.sin(t*0.7 + i) * 0.0005 + n*0.01;
      m.material.opacity = 0.10 + (Math.sin(t*0.6+i*0.3)+1)*0.03;
    });
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }
  animate();

  // responsive
  window.addEventListener('resize', ()=>{
    renderer.setSize(container.clientWidth, container.clientHeight);
    camera.aspect = container.clientWidth / container.clientHeight;
    camera.updateProjectionMatrix();
  });
})();
</script>
</body>
</html>
